# 💪開発手順書：予定リマインダーアプリ（メール通知）

## 概要

本ドキュメントは，予定リマインダーアプリケーションを Windows 上で開発し，Raspberry Pi 5 にデプロイして運用するための詳細な作業手順をまとめたものである．

---

## 📍 開発の全体フロー（時給列）

---

## STEP 1：開発環境構築（Windows）

### 1.1 必要なツールの準備

* Python 3.x をインストール（[https://www.python.org/）](https://www.python.org/）)
* VS Code またはお好みのエディタをインストール
* 以下のパッケージをインストール：

  ```bash
  pip install flask apscheduler
  ```

### 1.2 プロジェクト構成

```text
reminder-app/
├— app.py               # Flaskアプリ
├— scheduler.py         # 通知スケジューラ
├— database.db          # SQLite3 DB
├— templates/
│   ├— index.html
│   └— register.html
├— static/
│   └— style.css
└— README.md
```

---

## STEP 2：基本機能の実装（Flask）

### 2.1 Flaskアプリ構築

* `app.py` にルーティング実装（`/`, `/register`）
* `templates/` にフォーム画面と一覧ページ

### 2.2 SQLite DB設計

* `users` テーブル
* `events` テーブル（event\_id, user\_id, title, description, event\_datetime, remind\_datetime, notified）

### 2.3 CRUD機能実装

* 登録／一覧表示／削除／編集

---

## STEP 3：メール通知機能の実装

### 3.1 SMTP設定

* Gmail アカウントでアプリパスワードを発行
* `smtplib` を使ってメール送信関数を実装

### 3.2 通知処理

* `scheduler.py` に通知対象イベントの抽出＆メール送信
* `notified` フラグの更新

### 3.3 APScheduler 導入

* 毎分通知チェック関数を実行
* `log.txt` にログ出力

---

## STEP 4：ローカルテスト

### 4.1 Webアプリ確認

* `python app.py` → `http://localhost:5000` で確認
* 登録／通知／削除の一連テスト

### 4.2 メール通知確認

* 近い時刻で予定を登録し通知確認
* 通知済みイベントが重複送信されないか検証

---

## STEP 5：Raspberry Pi へのデプロイ

### 5.1 ファイル転送

* GitHub → Pi 上で `git clone`
* または `scp` を使用し `/home/pi/reminder-app/` に転送

### 5.2 Apache + mod\_wsgi 設定

* Apache2 インストール
* `/etc/apache2/sites-available/reminder.conf` 作成
* Flaskアプリを WSGI 経由で公開

### 5.3 Pi上の仮想環境

```bash
cd /home/pi/reminder-app/
python3 -m venv venv
source venv/bin/activate
pip install flask apscheduler
```

---

## STEP 6：スケジューラの常駐化（systemd）

### 6.1 systemd サービス登録

`/etc/systemd/system/reminder_scheduler.service`

```ini
[Unit]
Description=Reminder Email Scheduler
After=network.target

[Service]
ExecStart=/home/pi/reminder-app/venv/bin/python /home/pi/reminder-app/scheduler.py
Restart=always
User=pi
WorkingDirectory=/home/pi/reminder-app/

[Install]
WantedBy=multi-user.target
```

* サービス有効化＆起動：

```bash
sudo systemctl enable --now reminder_scheduler.service
```

* ログ確認：

```bash
journalctl -u reminder_scheduler.service
```

---

## STEP 7：仕上げ＆運用準備

### 7.1 README作成

* セットアップ手順
* 通知設定とテスト方法
* トラブルシューティング

### 7.2 UI調整

* レスポンシブデザイン（スマホでも見やすく）
* 日本語表記対応

---

## ✅ 完成！

この手順を終えると，予定を登録してメールでリマインドしてくれる Raspberry Pi アプリが運用可能になります．
今後，LINE通知や複数ユーザー対応も簡単に追加できます．
